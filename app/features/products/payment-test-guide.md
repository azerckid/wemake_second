# 토스페이먼츠 결제 테스트 가이드

## 테스트 준비

### 1. 서버 실행 확인
```bash
npm run dev
```
서버가 `http://localhost:5173`에서 실행 중이어야 합니다.

### 2. 브라우저 접속
- URL: `http://localhost:5173/products/promote`
- 개발자 도구 열기 (F12 또는 Cmd+Option+I)

## 테스트 체크리스트

### ✅ Phase 1: 페이지 로드 확인

1. **페이지 접속**
   - [ ] `/products/promote` 페이지가 정상적으로 로드됨
   - [ ] Hero 섹션에 "Promote Your Product" 표시됨

2. **결제 위젯 렌더링 확인**
   - [ ] 개발자 콘솔에 에러 없음
   - [ ] 오른쪽 사이드바에 결제 수단 선택 위젯 표시됨
   - [ ] 약관 동의 체크박스 표시됨
   - [ ] Checkout 버튼 표시됨 (초기에는 비활성화 상태)

### ✅ Phase 2: 날짜 선택 테스트

1. **날짜 선택**
   - [ ] 왼쪽 달력에서 시작일 선택 가능
   - [ ] 종료일 선택 가능
   - [ ] 최소 2일 이상 선택 가능

2. **금액 업데이트 확인**
   - [ ] 날짜 선택 시 오른쪽 위젯의 금액이 자동 업데이트됨
   - [ ] Checkout 버튼의 금액이 업데이트됨
   - [ ] 예: 3일 선택 시 "₩30,000" 표시

### ✅ Phase 3: 결제 요청 테스트

1. **필수 정보 입력**
   - [ ] 제품 선택: "AI Dark Mode Maker" 선택
   - [ ] 날짜 범위 선택 (최소 2일)
   - [ ] 결제 수단 선택 (신용카드, 계좌이체 등)

2. **Checkout 버튼 클릭**
   - [ ] 버튼이 활성화되어 있음
   - [ ] 클릭 시 토스페이먼츠 결제 창이 열림

### ✅ Phase 4: 테스트 결제 진행

#### 테스트 카드 정보

**신용카드:**
- 카드번호: `1234-5678-9012-3456` 또는 `1234567890123456`
- 유효기간: 미래 날짜 (예: `12/25`)
- CVV: `123`
- 카드 비밀번호: `1234`

**계좌이체:**
- 은행: 아무 은행 선택
- 계좌번호: `1234567890`

**가상계좌:**
- 자동 생성됨

**휴대폰 결제:**
- 전화번호: `010-1234-5678`
- 인증번호: 아무 숫자

#### 결제 진행

1. **결제 창에서 테스트 정보 입력**
   - [ ] 테스트 카드 정보 입력
   - [ ] 결제 진행 버튼 클릭

2. **결제 완료 확인**
   - [ ] 결제가 성공적으로 완료됨
   - [ ] `/products/promote/success` 페이지로 리디렉션됨

### ✅ Phase 5: 결제 승인 확인

1. **성공 페이지 확인**
   - [ ] "Payment Successful!" 메시지 표시
   - [ ] 결제 정보 표시:
     - [ ] 주문번호 표시
     - [ ] 결제 금액 표시
     - [ ] 결제 수단 표시
   - [ ] "View Products" 버튼 작동
   - [ ] "Go to Dashboard" 버튼 작동

2. **서버 사이드 승인 확인**
   - [ ] 개발자 콘솔에 에러 없음
   - [ ] 네트워크 탭에서 `/promote/success` 요청 성공 (200)
   - [ ] 토스페이먼츠 API 호출 성공

## 예상되는 문제 및 해결 방법

### 문제 1: 결제 위젯이 표시되지 않음

**증상:**
- 오른쪽 사이드바에 결제 수단 선택 위젯이 보이지 않음

**확인사항:**
1. 개발자 콘솔에 에러 확인
2. `#toss-payment-methods` div가 존재하는지 확인
3. 네트워크 탭에서 토스페이먼츠 SDK 로드 확인

**해결:**
- 콘솔 에러 메시지 확인
- 토스페이먼츠 클라이언트 키 확인

### 문제 2: 결제 창이 열리지 않음

**증상:**
- Checkout 버튼 클릭 시 아무 일도 일어나지 않음

**확인사항:**
1. 개발자 콘솔에 에러 확인
2. `widgets.current`가 null이 아닌지 확인
3. Form 데이터가 제대로 수집되는지 확인

**해결:**
- 콘솔에서 `❌ 결제 요청 실패` 에러 확인
- 날짜와 제품이 모두 선택되었는지 확인

### 문제 3: 결제 승인 실패

**증상:**
- 결제 완료 후 에러 페이지 또는 400 에러

**확인사항:**
1. URL 파라미터 확인 (`paymentKey`, `orderId`, `amount` 등)
2. Secret Key 확인
3. 네트워크 탭에서 API 응답 확인

**해결:**
- `promote-success-page.tsx`의 Secret Key 확인
- 토스페이먼츠 대시보드에서 Secret Key 확인

## 테스트 시나리오

### 시나리오 1: 정상 결제 흐름
1. 페이지 접속
2. 제품 선택: "AI Dark Mode Maker"
3. 날짜 선택: 오늘부터 3일 후까지
4. 결제 수단 선택: 신용카드
5. Checkout 버튼 클릭
6. 테스트 카드 정보 입력
7. 결제 완료
8. 성공 페이지 확인

### 시나리오 2: 검증 실패 테스트
1. 날짜만 선택하고 제품 선택 안 함
2. Checkout 버튼 클릭
3. Alert 메시지 확인: "제품과 날짜를 모두 선택해주세요."

### 시나리오 3: 금액 업데이트 테스트
1. 날짜 선택: 2일 → 금액 확인: ₩20,000
2. 날짜 변경: 5일 → 금액 확인: ₩50,000
3. 날짜 변경: 7일 → 금액 확인: ₩70,000

## 네트워크 요청 확인

개발자 도구의 Network 탭에서 다음 요청들을 확인:

1. **토스페이먼츠 SDK 로드**
   - `https://js.tosspayments.com/...`

2. **결제 승인 API**
   - `POST https://api.tosspayments.com/v1/payments/confirm`
   - Status: 200 OK
   - Response: 결제 정보 JSON

3. **성공 페이지 로드**
   - `GET /products/promote/success?paymentType=...&orderId=...&paymentKey=...&amount=...`
   - Status: 200 OK

## 참고사항

- 테스트 모드에서는 실제 금액이 차감되지 않습니다
- 토스페이먼츠 키는 `.env` 파일에서 환경 변수로 관리됩니다:
  - `VITE_TOSS_CLIENT_KEY`: 클라이언트 키 (브라우저)
  - `TOSS_SECRET_KEY`: Secret 키 (서버)

