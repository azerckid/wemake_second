# 전체 테이블 RLS 정책 요약

## ✅ RLS 활성화 완료

모든 public 스키마의 테이블에 RLS가 활성화되었습니다. (총 20개 테이블)

## 테이블별 RLS 정책 요약

### 📊 공개 읽기 가능 테이블 (Public Read)

다음 테이블들은 모든 사용자(`public`)가 읽기 가능하며, 작성/수정/삭제는 제한됩니다:

| 테이블 | 읽기 | 쓰기 | 수정 | 삭제 |
|--------|------|------|------|------|
| **categories** | ✅ 모든 사용자 | ✅ 인증된 사용자 | ✅ 인증된 사용자 | - |
| **topics** | ✅ 모든 사용자 | ✅ 인증된 사용자 | ✅ 인증된 사용자 | - |
| **profiles** | ✅ 모든 사용자 | - | ✅ 자신만 | - |
| **follows** | ✅ 모든 사용자 | ✅ 자신만 | - | ✅ 자신만 |
| **jobs** | ✅ 모든 사용자 | ✅ 자신만 | ✅ 자신만 | ✅ 자신만 |
| **products** | ✅ 모든 사용자 | ✅ 자신만 | ✅ 자신만 | - |
| **product_upvotes** | ✅ 모든 사용자 | ✅ 자신만 | - | ✅ 자신만 |
| **reviews** | ✅ 모든 사용자 | ✅ 인증된 사용자 | ✅ 자신만 | ✅ 자신만 |
| **gpt_ideas** | ✅ 모든 사용자 | - | ✅ 클레임 가능 | - |
| **gpt_ideas_likes** | ✅ 모든 사용자 | ✅ 자신만 | - | ✅ 자신만 |
| **posts** | ✅ 모든 사용자 | ✅ 자신만 | ✅ 자신만 | ✅ 자신만 |
| **post_replies** | ✅ 모든 사용자 | ✅ 인증된 사용자 | ✅ 자신만 | ✅ 자신만 |
| **post_upvotes** | ✅ 모든 사용자 | ✅ 자신만 | - | ✅ 자신만 |
| **teams** | ✅ 모든 사용자 | ✅ 자신만 | ✅ 자신만 | ✅ 자신만 |
| **events** | ✅ 모든 사용자 | ✅ 자신만 | - | - |

### 🔒 제한된 접근 테이블 (Restricted Access)

| 테이블 | 읽기 | 쓰기 | 수정 | 삭제 |
|--------|------|------|------|------|
| **team_members** | ✅ 자신의 팀만 | ✅ 팀 리더만 | ✅ 팀 리더만 | ✅ 팀 리더만 |
| **notifications** | ✅ 자신만 | ✅ 인증된 사용자 | ✅ 자신만 | ✅ 자신만 |
| **message_rooms** | ✅ 자신이 속한 룸만 | ✅ 인증된 사용자 | - | - |
| **message_room_members** | ✅ 자신의 멤버십만 | ✅ 자신만 | - | - |
| **messages** | ✅ 자신이 속한 룸만 | ✅ 자신이 속한 룸만 | ✅ 자신만 | ✅ 자신만 |

## 정책 상세 설명

### 1. profiles (프로필)
- **읽기**: 모든 사용자가 모든 프로필 읽기 가능
- **수정**: 자신의 프로필만 수정 가능

### 2. follows (팔로우)
- **읽기**: 모든 사용자가 팔로우 관계 읽기 가능
- **생성/삭제**: 자신의 팔로우만 관리 가능

### 3. jobs (채용 공고)
- **읽기**: 모든 사용자가 모든 채용 공고 읽기 가능
- **생성/수정/삭제**: 자신의 채용 공고만 관리 가능

### 4. products (제품)
- **읽기**: 모든 사용자가 모든 제품 읽기 가능
- **생성/수정**: 자신의 제품만 관리 가능

### 5. product_upvotes (제품 좋아요)
- **읽기**: 모든 사용자가 좋아요 읽기 가능
- **생성/삭제**: 자신의 좋아요만 관리 가능

### 6. reviews (리뷰)
- **읽기**: 모든 사용자가 모든 리뷰 읽기 가능
- **생성**: 인증된 사용자는 리뷰 작성 가능
- **수정/삭제**: 자신의 리뷰만 관리 가능

### 7. gpt_ideas (GPT 아이디어)
- **읽기**: 모든 사용자가 모든 아이디어 읽기 가능
- **클레임**: 인증된 사용자는 클레임되지 않은 아이디어만 클레임 가능

### 8. gpt_ideas_likes (아이디어 좋아요)
- **읽기**: 모든 사용자가 좋아요 읽기 가능
- **생성/삭제**: 자신의 좋아요만 관리 가능

### 9. posts (포스트)
- **읽기**: 모든 사용자가 모든 포스트 읽기 가능
- **생성/수정/삭제**: 자신의 포스트만 관리 가능

### 10. post_replies (댓글)
- **읽기**: 모든 사용자가 모든 댓글 읽기 가능
- **생성**: 인증된 사용자는 댓글 작성 가능
- **수정/삭제**: 자신의 댓글만 관리 가능

### 11. post_upvotes (포스트 좋아요)
- **읽기**: 모든 사용자가 좋아요 읽기 가능
- **생성/삭제**: 자신의 좋아요만 관리 가능

### 12. topics (토픽)
- **읽기**: 모든 사용자가 모든 토픽 읽기 가능
- **생성/수정**: 인증된 사용자는 토픽 관리 가능

### 13. teams (팀)
- **읽기**: 모든 사용자가 모든 팀 정보 읽기 가능
- **생성/수정/삭제**: 자신이 리더인 팀만 관리 가능

### 14. team_members (팀 멤버)
- **읽기**: 자신의 팀 멤버십 또는 자신이 리더인 팀의 멤버 읽기 가능
- **생성/수정/삭제**: 팀 리더만 관리 가능

### 15. events (이벤트)
- **읽기**: 모든 사용자가 모든 이벤트 읽기 가능 (분석 목적)
- **생성**: 인증된 사용자는 자신의 이벤트만 생성 가능

### 16. notifications (알림)
- **읽기**: 자신의 알림만 읽기 가능
- **생성**: 인증된 사용자는 알림 생성 가능 (서버 사이드에서 주로 사용)
- **수정/삭제**: 자신의 알림만 관리 가능

### 17-20. messages 관련 테이블
- 자세한 내용은 `rls-policies-documentation.md` 참고

## 보안 효과

✅ **데이터 격리**: 사용자는 자신이 소유하거나 접근 권한이 있는 데이터만 접근 가능
✅ **무단 접근 방지**: 다른 사용자의 데이터에 접근 불가
✅ **Realtime 보안**: Supabase Realtime이 RLS 정책을 따르므로 실시간 기능도 안전하게 작동
✅ **데이터베이스 레벨 보안**: 애플리케이션 코드 레벨에서의 보안 검증 없이도 데이터베이스 레벨에서 보안 보장

## Security Advisor 결과

- ✅ **RLS 비활성화 에러 제거**: 모든 테이블에 RLS가 활성화됨
- ⚠️ **남은 경고**: Views의 SECURITY DEFINER 속성 (별도 검토 필요)
- ⚠️ **남은 경고**: 함수의 search_path 설정 (별도 검토 필요)

## 다음 단계

1. ✅ 모든 테이블 RLS 활성화 완료
2. 🔄 Views의 SECURITY DEFINER 속성 검토 (선택사항)
3. 🔄 함수의 search_path 설정 검토 (선택사항)

