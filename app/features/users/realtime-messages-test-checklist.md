# 실시간 메시지 기능 테스트 체크리스트

## 사전 준비 사항

### ✅ 1. Supabase Realtime 활성화 확인
- [ ] Supabase Dashboard 접속
- [ ] Database → **Replication** 메뉴 이동
- [ ] `messages` 테이블 옆 **Enable** 버튼 클릭
- [ ] 또는 SQL Editor에서 다음 명령 실행:
  ```sql
  -- messages 테이블을 Realtime publication에 추가
  alter publication supabase_realtime add table messages;
  ```

### ✅ 2. 환경 변수 확인
- [ ] `.env` 파일에 다음 변수 확인:
  ```
  VITE_SUPABASE_URL=https://araxhycujuxowmzfjtkd.supabase.co
  VITE_SUPABASE_ANON_KEY=your_anon_key
  ```
- [ ] 브라우저 콘솔에서 오류 없이 로드되는지 확인

### ✅ 3. 개발 서버 실행
- [ ] `npm run dev` 실행
- [ ] 브라우저에서 메시지 페이지 접속 가능한지 확인

---

## 테스트 항목

### 📋 테스트 1: 메시지 전송 후 즉시 화면에 표시되는지 확인

**테스트 단계:**
1. 브라우저에서 메시지 페이지 열기
2. 메시지 입력 후 전송
3. 같은 페이지에서 즉시 메시지가 나타나는지 확인

**예상 결과:**
- ✅ 메시지 전송 후 즉시 화면에 표시됨
- ✅ 중복 메시지 없음
- ✅ 메시지가 올바른 순서로 표시됨 (created_at 기준)

**확인 사항:**
- 브라우저 콘솔에 에러가 없는지 확인
- Network 탭에서 WebSocket 연결이 활성화되어 있는지 확인
- React DevTools에서 messages state가 업데이트되는지 확인

---

### 📋 테스트 2: 다른 브라우저/탭에서도 실시간 반영되는지 확인

**테스트 단계:**
1. 브라우저 A에서 메시지 페이지 열기
2. 브라우저 B(또는 시크릿 모드)에서 같은 메시지 룸 열기
3. 브라우저 A에서 메시지 전송
4. 브라우저 B에서 즉시 메시지가 나타나는지 확인

**예상 결과:**
- ✅ 브라우저 B에서 즉시 새 메시지 수신
- ✅ 양쪽 브라우저 모두 올바른 메시지 표시
- ✅ 메시지 순서가 일치함

**확인 사항:**
- 각 브라우저의 콘솔에서 Realtime 구독 메시지 확인
- Network 탭에서 WebSocket 연결 확인

---

### 📋 테스트 3: 메시지 상태가 올바르게 관리되는지 확인

**테스트 단계:**
1. 메시지 여러 개 전송
2. 페이지 새로고침
3. 모든 메시지가 올바르게 표시되는지 확인
4. 새 메시지 전송 후 상태 확인

**예상 결과:**
- ✅ 페이지 로드 시 기존 메시지 모두 표시
- ✅ 새 메시지 전송 후 상태 업데이트 정상
- ✅ 중복 메시지 없음
- ✅ 메시지 순서 정확함

**확인 사항:**
- React DevTools에서 messages state 확인
- 콘솔에서 중복 체크 로직 동작 확인

---

### 📋 테스트 4: 페이지 이동 시 구독이 정리되는지 확인

**테스트 단계:**
1. 메시지 페이지 열기
2. 다른 페이지로 이동
3. 다시 메시지 페이지로 돌아오기
4. 메시지 전송하여 정상 동작 확인

**예상 결과:**
- ✅ 페이지 이동 시 구독 해제됨 (메모리 누수 없음)
- ✅ 다시 돌아올 때 새로 구독됨
- ✅ 메시지 수신 정상 동작

**확인 사항:**
- 브라우저 DevTools → Memory → Heap Snapshot으로 메모리 누수 확인
- 콘솔에서 cleanup 함수 실행 확인

---

## 디버깅 팁

### 문제: 메시지가 실시간으로 나타나지 않음

**확인 사항:**
1. Supabase Dashboard에서 Realtime 활성화 확인
2. 브라우저 콘솔에서 WebSocket 연결 확인
3. Network 탭에서 `wss://` 연결 확인
4. 환경 변수가 올바르게 설정되었는지 확인

### 문제: 중복 메시지 표시

**확인 사항:**
1. 중복 체크 로직 (`message_id` 비교) 확인
2. React DevTools에서 state 업데이트 확인
3. 같은 메시지가 여러 번 수신되는지 콘솔 로그 확인

### 문제: 페이지 이동 후 메시지가 사라짐

**확인 사항:**
1. `shouldRevalidate = false` 설정 확인
2. loader에서 메시지가 올바르게 로드되는지 확인
3. state 초기화 로직 확인

---

## 성공 기준

모든 테스트 항목이 통과하면:
- ✅ 실시간 메시지 기능이 정상적으로 동작함
- ✅ 성능 문제 없음
- ✅ 메모리 누수 없음
- ✅ 사용자 경험이 우수함

---

## 다음 단계

테스트 완료 후:
1. 프로덕션 환경에서도 동일한 테스트 수행
2. 부하 테스트 고려 (많은 동시 사용자)
3. 에러 처리 및 사용자 피드백 개선

